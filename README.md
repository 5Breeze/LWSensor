# BTHome 门窗状态与光照传感器项目简介

项目链接：https://oshwhub.com/bitshen/bthome

BTHome 协议是一种轻量级的蓝牙通信协议，专为智能家居传感器设备与接收端（如网关或主控设备）之间的数据传输设计。

本项目基于 BTHome 协议，结合 TI 霍尔传感器与光度传感器，实现了门窗状态、光照强度、电池电压等数据的精准采集与上报。核心硬件使用了 **CH592F** MCU，整体电路设计极为精简，无需使用任何电阻元件即可完成焊接组装。

---

## 功能与采集内容

### 1. 光照强度
- 采样频率：每 40 秒采集一次
- 传感器：TI 光度传感器
- 功能描述：实时监测环境光照强度，适用于室内光照调节等应用场景。

### 2. 门窗关合次数
- 触发方式：每次关门触发 MCU 中断
- 记录内容：累计关门的次数
- 功能描述：通过霍尔传感器实时记录门窗开关动作次数。

### 3. 门窗当前状态
- 实时记录当前门窗开/关状态，方便状态监测与联动控制。

### 4. 电池电压监测
- 监测纽扣电池当前电压，便于掌握电量使用情况并及时更换电池。

---

## 项目硬件设计

- **主控芯片**：WCH CH592F
- **霍尔传感器**：TI 系列
- **光度传感器**：TI 系列
- **电路特点**：
  - 极简布局
  - 无需焊接电阻元件
  - 低成本、高集成度

---

## 已知问题与待完善事项

- **天线部分匹配不好**  
---

## 使用说明

### 1. 固件烧录

- 使用 **WCH_TOOL** 工具进行固件烧录。
- 烧录流程简单，支持量产化操作。

### 2. 与 Home Assistant 配合使用

- 烧录完成后，在 Home Assistant (HA) 中添加设备。
- 设备通常会自动弹出识别，显示名称为 **LWSensor**。
- 完成添加后可实时查看传感器数据，并支持自动化联动。

---

## 通信机制补充说明

在实际使用过程中发现：

- **广播频率**：默认采用 2 秒广播一次的方式。
- **丢包问题**：当门窗在 1 秒内多次开关时，某些广播可能因上游服务器采样周期限制被遗漏，导致状态数据丢失。
- **改进措施**：增加关门次数统计值，将其包含在广播数据中，即使部分广播丢失，依然可以通过累计次数判断状态变化，确保数据完整性和可靠性。

---

 <span style="color:red">本项目禁止商用</span> 
